<html>
  <head>
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script type="text/javascript">
      google.charts.load('current', {'packages':['corechart', 'calendar']});
      google.charts.setOnLoadCallback(drawCharts);

      async function drawCharts() {
        await drawPieChart();
        await drawCalendarChart();
        await drawScatterChart();
      }

      async function drawPieChart() {
        // Fetch activity data from the API (already in Google Charts format)
        const response = await fetch('/api/nb_activities_by_type');
        const chartData = await response.json();

        var data = google.visualization.arrayToDataTable(chartData);

        var options = {
          title: 'Activities by Type'
        };

        var chart = new google.visualization.PieChart(document.getElementById('piechart'));

        chart.draw(data, options);
      }

      async function drawCalendarChart() {
        // Fetch activity dates from the API (already in Google Charts format)
        const response = await fetch('/api/nb_activities_by_date');
        const chartData = await response.json();

        // Convert date strings to Date objects for the calendar chart
        const processedData = chartData.map((row, index) => {
          if (index === 0) return row; // Keep header row as-is
          return [new Date(row[0]), row[1]]; // Convert date string to Date object
        });

        var data = google.visualization.arrayToDataTable(processedData);

        var options = {
          title: 'Activities Calendar',
          height: 800,
          colorAxis: {
            minValue: 0,
          }
        };

        var chart = new google.visualization.Calendar(document.getElementById('calendar'));

        chart.draw(data, options);
      }

      async function drawScatterChart() {
        // Fetch speed by distance data from the API (already in Google Charts format)
        const response = await fetch('/api/speed_by_distance');
        const chartData = await response.json();

        var data = google.visualization.arrayToDataTable(chartData);

        var options = {
          title: 'Speed by Distance by Activity Type',
          hAxis: {title: 'Distance (m)'},
          vAxis: {title: 'Average Speed (m/s)'},
          legend: {position: 'right'}
        };

        var chart = new google.visualization.ScatterChart(document.getElementById('scatterchart'));

        chart.draw(data, options);
      }
    </script>
  </head>
  <body style="margin: 20px; overflow: auto;">
    <div id="piechart" style="width: 900px; height: 500px;"></div>
    <div id="calendar" style="width: 1000px;"></div>
    <div id="scatterchart" style="width: 900px; height: 500px;"></div>
  </body>
</html>